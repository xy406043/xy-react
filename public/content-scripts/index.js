(()=>{var p=c=>{let u=new RegExp(/http/),i=new RegExp(/\/\//);return!u.test(c)&&!i.test(c)?document.location.origin+"/"+c:i.test(c)?c:document.location.protocol+c};var a=[],h=[],I=new RegExp(/http/);d();chrome.runtime.onMessage.addListener(function(c,u,i){i("background\u4F60\u597D\uFF0C\u6211\u6536\u5230\u4E86\u4F60\u7684\u6D88\u606F\uFF01"+c.type),c.type==="tabUpdate"&&d()});async function d(){a=[],h=[],c(!0);async function c(u){async function i(){let r=[];return r.push(new Promise(n=>{["shortcut icon","icon","alternate icon","mask-icon","apple-touch-icon"].forEach(o=>{let e=document.querySelector(`link[rel="${o}"]`)?.getAttribute("href");e&&a.push(p(e))}),n(!0)})),u&&r.push(new Promise((n,t)=>{let o=document.querySelector('link[rel="manifest"]')?.getAttribute("href");o?fetch(o).then(async e=>{let s=await e.json();!s.icons||!s.icons.length||(s.icons.forEach(g=>{a.push(p(g.src))}),n(!0))}).catch(()=>{n(!0)}):n(!0)})),r.push(new Promise(n=>{let t=new Image;t.src=document.location.origin+"/favicon.ico",t.crossOrigin="anonymous",t.onload=function(){a.push(t.src),n(!0)},t.onerror=function(){console.log("\u8BE5\u94FE\u63A5\u65E0\u6548",t.src),n(!0)}})),Promise.all(r)}function l(){let r=["description","twitter:description"],n=["og:description","twitter:description"],t=document.getElementsByTagName("meta"),o=[];for(let e=0;e<t.length;e++)r.includes(t[e]?.getAttribute("name"))&&o.push(t[e].getAttribute("content")),n.includes(t[e]?.getAttribute("property"))&&o.push(t[e].getAttribute("content"));return o}async function y(){let r=["image","twitter:image","twitter:image:src"],n=["og:image"],t=["name","property","itemprop"],o=document.getElementsByTagName("meta"),e=[];for(let s=0;s<o.length;s++)t.forEach(g=>{let m=o[s].getAttribute("content"),f=I.test(m)?m:document.location.origin+"/"+m;r.includes(o[s].getAttribute(g))&&e.push(f),n.includes(o[s].getAttribute(g))&&e.push(f)});h=e}let w=document.getElementsByTagName("title")[0]?.innerText,A=window.location.href,b=l()[0]||"",x=document.querySelector('meta[name="keywords"]')?.getAttribute("content");await i(),y(),E();function E(){let r={pageTitle:w,linkUrl:A,desc:b,keywords:x,icons:a,imgs:h};chrome.runtime.sendMessage(r,n=>{})}}}var k={};})();
//# sourceMappingURL=index.js.map
