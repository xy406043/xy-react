{
  "version": 3,
  "sources": ["../../src/utils/webUtil.ts", "../../src/adapter/chrome/content-scripts/index.ts"],
  "sourcesContent": ["/**\n * \u7F51\u5740\u8865\u5168 - \u53EF\u7528\u4E8E\u7AD9\u70B9\u8DEF\u5F84\u8BBF\u95EE\n * @param linkUrl \u94FE\u63A5\n * @returns \u6709\u6548\u7684\u94FE\u63A5\u5730\u5740\n */\nexport const checkPreHref = (linkUrl: string) => {\n  const httpRegex = new RegExp(/http/)\n  const preRegex = new RegExp(/\\/\\//)\n\n  if (!httpRegex.test(linkUrl) && !preRegex.test(linkUrl)) {\n    return document.location.origin + '/' + linkUrl\n  } else if (!preRegex.test(linkUrl)) {\n    return document.location.protocol + linkUrl\n  } else {\n    return linkUrl\n  }\n}\n", "// content-scripts \u5411\u539F\u9875\u9762\u6CE8\u5165\u811A\u672C\u3002 \u6216\u8005 \u5728popup.js  \u4E2D   \u901A\u8FC7chrome.scripting.executeScript \u52A8\u6001\u6CE8\u5165\u811A\u672C\n// \u4EE5\u4E0A \u90FD \u65E0\u6CD5\u83B7\u53D6 \u539F\u9875\u9762Js\u3002 \u5982\u9700\u6B64\u7B49\u64CD\u4F5C \uFF0C\u5219\u9700\u4F7F\u7528 inject-scripts\n\n// content-scrips \u8981\u505A\u7684\u4E8B\u60C5\u6BD4\u8F83\u7B80\u5355  \u6839\u636E\u63D2\u4EF6\u9700\u8981\u7684\u5185\u5BB9 \u83B7\u53D6\u9875\u9762\u7684\u4FE1\u606F\u3002\n// \u800C\u540E\u5C06\u5176\u53D1\u9001\u7ED9background \u901A\u8FC7chrome.storage \u5B58\u50A8 (\u4F9D\u636EtabId\u8FDB\u884C\u5B58\u50A8) \uFF0C\u5F53\u70B9\u51FB popup \u7684\u65F6\u5019 \uFF0Cpopup.js \u4E5F\u5C31\u53EF\u4EE5\u901A\u8FC7chrome.storage \u83B7\u53D6\n\n// content-scripts \u53EA\u80FD\u8BBF\u95EE\u4EE5\u4E0BApi\n// chrome.runtime\n// chrome.extension (manifest_version <=2)\n// chrome.i18n\n// chrome.storage\n\n// TODO  \u7B80\u5316\u4EE3\u7801\uFF0C\u4F7F\u7528 \u6B63\u5219\u8FDB\u884C\u6807\u7B7E\u5339\u914D\n// TODO   \u89E3\u51B3\u90E8\u5206\u7F51\u9875\u7684\u56FE\u6807\u6CA1\u6709\u57DF\u540D\u7684\u95EE\u9898\n\nimport { checkPreHref } from '@/utils/webUtil'\n\nlet showIconsList = [] as any\nlet showImagesList = [] as any\nconst httpRegex = new RegExp(/http/)\n\nloadScript()\n\n// \u76D1\u542C\u6765\u81EA background \u7684\u6D88\u606F\nchrome.runtime.onMessage.addListener(function (request, sender, sendResponse) {\n  sendResponse('background\u4F60\u597D\uFF0C\u6211\u6536\u5230\u4E86\u4F60\u7684\u6D88\u606F\uFF01' + request.type)\n\n  if (request.type === 'tabUpdate') {\n    loadScript()\n  }\n})\n\nasync function loadScript() {\n  showIconsList = []\n  showImagesList = []\n\n  loadInfo(true)\n\n  async function loadInfo(hasLoadFetch) {\n    // ================================ \u83B7\u53D6\u7F51\u9875\u7684 Icon =================================\n    async function getIcons() {\n      const requestList: Array<any> = []\n      // \u65B9\u5F0F\u4E00 \u76F4\u63A5\u83B7\u53D6link\u5C5E\u6027 \u622A\u53D6url\u3002 shortcut icon \u662F\u8FC7\u65F6\u7684\u5199\u6CD5\n      requestList.push(\n        new Promise(resolve => {\n          const textArr = ['shortcut icon', 'icon', 'alternate icon', 'mask-icon', 'apple-touch-icon']\n          textArr.forEach(item => {\n            const checkHref: any = document.querySelector(`link[rel=\"${item}\"]`)?.getAttribute('href')\n\n            if (checkHref) showIconsList.push(checkPreHref(checkHref))\n          })\n          resolve(true)\n        })\n      )\n\n      // \u65B9\u5F0F\u4E8C PWA \u5E94\u7528\u53EF\u4EE5\u83B7\u53D6\u6839\u57DF\u540D\u7684manifest  \u6709\u94FE\u63A5\u7684\u8FD4\u56DE\u94FE\u63A5 \u6CA1\u6709\u7684\u76F4\u63A5\u8FDB\u884C\u62FC\u63A5\n      // \u53EA\u6709 fetch \u5F15\u5165\u6210\u529F\u65F6\u624D\u53EF\u4EE5\u4F7F\u7528\n      if (hasLoadFetch) {\n        requestList.push(\n          new Promise((resolve, reject) => {\n            const pwaUrl = document.querySelector('link[rel=\"manifest\"]')?.getAttribute('href')\n            if (pwaUrl) {\n              fetch(pwaUrl)\n                .then(async res => {\n                  const data = await res.json()\n\n                  if (!data.icons || !data.icons.length) return\n\n                  data.icons.forEach(iconItem => {\n                    showIconsList.push(checkPreHref(iconItem.src))\n                  })\n\n                  resolve(true)\n                })\n                .catch(() => {\n                  resolve(true)\n                })\n            } else {\n              resolve(true)\n            }\n          })\n        )\n      }\n\n      // \u65B9\u5F0F\u4E09 \u672A\u8BBE\u7F6E link rel=type,\u800C\u662F\u76F4\u63A5\u653E\u5230\u7F51\u7AD9\u6839\u76EE\u5F55\u4E0B\uFF0C\u6D4F\u89C8\u5668\u4F1A  \u76F4\u63A5\u83B7\u53D6 favicon.ico\n      requestList.push(\n        new Promise(resolve => {\n          const img = new Image()\n          img.src = document.location.origin + '/favicon.ico'\n          img.crossOrigin = 'anonymous'\n          img.onload = function () {\n            // console.log('\u6DFB\u52A0icon', document.location.origin, img.src)\n            showIconsList.push(img.src)\n            resolve(true)\n          }\n          img.onerror = function () {\n            console.log('\u8BE5\u94FE\u63A5\u65E0\u6548', img.src)\n            resolve(true)\n          }\n        })\n      )\n\n      return Promise.all(requestList)\n    }\n\n    // \u83B7\u53D6\u7F51\u9875\u63CF\u8FF0\n    function getDesc() {\n      const textArrDes = ['description', 'twitter:description']\n      const richList = ['og:description', 'twitter:description']\n      const oMe: any = document.getElementsByTagName('meta')\n\n      const descList: Array<any> = []\n      for (let i = 0; i < oMe.length; i++) {\n        if (textArrDes.includes(oMe[i]?.getAttribute('name'))) {\n          descList.push(oMe[i].getAttribute('content'))\n        }\n        if (richList.includes(oMe[i]?.getAttribute('property'))) {\n          descList.push(oMe[i].getAttribute('content'))\n        }\n      }\n      // console.log(\"\u63CF\u8FF0List\", descList);\n\n      return descList\n    }\n\n    // ========================== \u83B7\u53D6\u7F51\u9875\u9884\u89C8\u56FE =====================================\n    async function getImgs() {\n      const textArrDes = ['image', 'twitter:image', 'twitter:image:src']\n      const richList = ['og:image']\n      const catchProperty = ['name', 'property', 'itemprop']\n      const oMe: any = document.getElementsByTagName('meta')\n\n      const subImgs: Array<string> = []\n      // \u6446\u70C2 - \u6CA1\u6709\u7684\u4E0D\u4F1A\u5339\u914D\u5230 - \u5C31\u8FD9\u6837\u5427\n      for (let i = 0; i < oMe.length; i++) {\n        catchProperty.forEach(y => {\n          const imgContent = oMe[i].getAttribute('content') as string\n          const url = httpRegex.test(imgContent) ? imgContent : document.location.origin + '/' + imgContent\n\n          if (textArrDes.includes(oMe[i].getAttribute(y))) {\n            subImgs.push(url)\n          }\n          if (richList.includes(oMe[i].getAttribute(y))) {\n            subImgs.push(url)\n          }\n        })\n      }\n      // console.log(\"\u9884\u89C8\u56FEList\", subImgs);\n      showImagesList = subImgs\n    }\n\n    // \u83B7\u53D6\u7F51\u9875title\n    const titles = document.getElementsByTagName('title')\n    const pageTitle = titles[0]?.innerText\n\n    // \u83B7\u53D6\u7F51\u9875\u94FE\u63A5\n    const linkUrl = window.location.href\n\n    // description\n    const desc = getDesc()[0] || ''\n\n    // \u83B7\u53D6\u7F51\u9875\u5173\u952E\u8BCD\n    const keywords = document.querySelector('meta[name=\"keywords\"]')?.getAttribute('content')\n\n    // \u83B7\u53D6\u7F51\u9875icon\n    await getIcons()\n\n    // \u83B7\u53D6\u7F51\u9875\u9884\u89C8\u56FE\n    getImgs()\n\n    addContent()\n\n    // \u5C06\u83B7\u53D6\u5230\u7684\u6570\u636E \u4F20\u8F93\u7ED9background.js \u6216\u8005 popup.js\n    function addContent() {\n      const pageData = {\n        pageTitle,\n        linkUrl,\n        desc,\n        keywords,\n        icons: showIconsList,\n        imgs: showImagesList\n      }\n      // console.log('xy-react \u83B7\u53D6\u9875\u9762\u6570\u636E\u5185\u5BB9', pageData, LocalPageDataInfo)\n      chrome.runtime.sendMessage(pageData, res => {\n        // console.log('content-scripts \u6536\u5230 \u6765\u81EA\u540E\u53F0\u7684\u56DE\u590D\u6570\u636E', res)\n      })\n    }\n  }\n}\n\nexport default {}\n"],
  "mappings": "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",
  "names": []
}
