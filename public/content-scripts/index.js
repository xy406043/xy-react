(()=>{async function d(){let s={active:!0,currentWindow:!0},[a]=await chrome.tabs.query(s);return a}var g=[],p=[],y=new RegExp(/http/);f();chrome.runtime.onMessage.addListener(function(s,a,i){i("background\u4F60\u597D\uFF0C\u6211\u6536\u5230\u4E86\u4F60\u7684\u6D88\u606F\uFF01"+s.type),s.type==="tabUpdate"&&f()});function D(s){let a=[];Object.keys(s).forEach(i=>{let l=["icons","imgs"];a.push({title:i,type:l.includes(i)?"img":"text",content:s[i]})}),chrome.storage.sync.get(["LocalPageData"],i=>{chrome.storage.sync.set({LocalPageData:[a]},()=>{})})}async function f(){let s=await d();g=[],p=[],a(!0);async function a(i){async function l(){let r=[];return r.push(new Promise((n,c)=>{["shortcut icon","icon","alternate icon","mask-icon","apple-touch-icon"].forEach(e=>{let o=document.querySelector(`link[rel="${e}"]`)?.getAttribute("href");o&&g.push(o)}),n(!0)})),i&&r.push(new Promise((n,c)=>{let t=document.querySelector('link[rel="manifest"]')?.getAttribute("href");t?fetch(t).then(async e=>{let o=await e.json();!o.icons||!o.icons.length||(o.icons.forEach((u,m)=>{let h=y.test(u.src)?u.src:document.location.origin+"/"+u.src;g.push(h)}),n(!0))}).catch(()=>{n(!0)}):n(!0)})),r.push(new Promise((n,c)=>{let t=new Image;t.src=document.location.origin+"/favicon.ico",t.crossOrigin="anonymous",t.onload=function(){g.push(t.src),n(!0)},t.onerror=function(){console.log("\u8BE5\u94FE\u63A5\u65E0\u6548",t.src),n(!0)}})),Promise.all(r)}function b(){let r=["description","twitter:description"],n=["og:description","twitter:description"],c=document.getElementsByTagName("meta"),t=[];for(let e=0;e<c.length;e++)r.includes(c[e]?.getAttribute("name"))&&t.push(c[e].getAttribute("content")),n.includes(c[e]?.getAttribute("property"))&&t.push(c[e].getAttribute("content"));return t}async function w(){let r=["image","twitter:image","twitter:image:src"],n=["og:image"],c=["name","property","itemprop"],t=document.getElementsByTagName("meta"),e=[];for(let o=0;o<t.length;o++)c.forEach(u=>{let m=t[o].getAttribute("content"),h=y.test(m)?m:document.location.origin+"/"+m;r.includes(t[o].getAttribute(u))&&e.push(h),n.includes(t[o].getAttribute(u))&&e.push(h)});p=e}let x=document.getElementsByTagName("title")[0]?.innerText,A=window.location.href,k=b()[0]||"",P=document.querySelector('meta[name="keywords"]')?.getAttribute("content");await l(),w(),L();function L(){let r={tabId:s.id,pageTitle:x,linkUrl:A,desc:k,keywords:P,icons:g,imgs:p};D(r)}}}var q={};})();
//# sourceMappingURL=index.js.map
