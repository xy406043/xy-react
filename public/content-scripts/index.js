(()=>{var u=[],d=[],p=new RegExp(/http/);f();chrome.runtime.onMessage.addListener(function(r,l,s){s("background\u4F60\u597D\uFF0C\u6211\u6536\u5230\u4E86\u4F60\u7684\u6D88\u606F\uFF01"+r.type),r.type==="tabUpdate"&&f()});function x(r){let l=[];Object.keys(r).forEach(s=>{let h=["icons","imgs"];l.push({title:s,type:h.includes(s)?"img":"text",content:r[s]})}),chrome.storage.sync.get(["LocalPageData"],s=>{chrome.storage.sync.set({LocalPageData:[l]},()=>{})})}async function f(r){LocalPageDataInfo=[],u=[],d=[],l(!0);async function l(s){async function h(){let c=[];return c.push(new Promise((n,i)=>{["shortcut icon","icon","alternate icon","mask-icon","apple-touch-icon"].forEach(e=>{let o=document.querySelector(`link[rel="${e}"]`)?.href;o&&u.push(o)}),n()})),s&&c.push(new Promise((n,i)=>{let t=document.querySelector('link[rel="manifest"]')?.href;t?fetch(t).then(async e=>{let o=await e.json();!o.icons||!o.icons.length||(o.icons.forEach((a,g)=>{let m=p.test(a.src)?a.src:document.location.origin+"/"+a.src;u.push(m)}),n())}).catch(()=>{n()}):n()})),c.push(new Promise((n,i)=>{let t=new Image;t.src=document.location.origin+"/favicon.ico",t.crossOrigin="anonymous",t.onload=function(){u.push(t.src),n()},t.onerror=function(){console.log("\u8BE5\u94FE\u63A5\u65E0\u6548",t.src),n()}})),Promise.all(c)}function y(){let c=["description","twitter:description"],n=["og:description","twitter:description"],i=document.getElementsByTagName("meta"),t=[];for(let e=0;e<i.length;e++)c.includes(i[e].getAttribute("name"))&&t.push(i[e].getAttribute("content")),n.includes(i[e].getAttribute("property"))&&t.push(i[e].getAttribute("content"));return t}async function w(){let c=["image","twitter:image","twitter:image:src"],n=["og:image"],i=["name","property","itemprop"],t=document.getElementsByTagName("meta"),e=[];for(let o=0;o<t.length;o++)i.forEach(a=>{let g=t[o].getAttribute("content"),m=p.test(g)?g:document.location.origin+"/"+g;c.includes(t[o].getAttribute(a))&&e.push(m),n.includes(t[o].getAttribute(a))&&e.push(m)});d=e}let b=document.getElementsByTagName("title")[0]?.innerText,A=window.location.href,L=y()[0]||"",P=document.querySelector('meta[name="keywords"]')?.content||"";await h(),w(),k();function k(){let c={tabId:r||0,pageTitle:b,linkUrl:A,desc:L,keywords:P,icons:u,imgs:d};LocalPageDataInfo=c,x(c)}}}})();
//# sourceMappingURL=index.js.map
