{
  "version": 3,
  "sources": ["../../src/utils/content-scripts/index.js"],
  "sourcesContent": ["// content-scripts \u5411\u539F\u9875\u9762\u6CE8\u5165\u811A\u672C\u3002 \u6216\u8005 \u5728popup.js  \u4E2D   \u901A\u8FC7chrome.scripting.executeScript \u52A8\u6001\u6CE8\u5165\u811A\u672C\n// \u4EE5\u4E0A \u90FD \u65E0\u6CD5\u83B7\u53D6 \u539F\u9875\u9762Js\u3002 \u5982\u9700\u6B64\u7B49\u64CD\u4F5C \uFF0C\u5219\u9700\u4F7F\u7528 inject-scripts\n\n// content-scrips \u8981\u505A\u7684\u4E8B\u60C5\u6BD4\u8F83\u7B80\u5355  \u6839\u636E\u63D2\u4EF6\u9700\u8981\u7684\u5185\u5BB9 \u83B7\u53D6\u9875\u9762\u7684\u4FE1\u606F\u3002\n// \u800C\u540E\u5C06\u5176\u53D1\u9001\u7ED9background \u901A\u8FC7chrome.storage \u5B58\u50A8 (\u4F9D\u636EtabId\u8FDB\u884C\u5B58\u50A8) \uFF0C\u5F53\u70B9\u51FB popup \u7684\u65F6\u5019 \uFF0Cpopup.js \u4E5F\u5C31\u53EF\u4EE5\u901A\u8FC7chrome.storage \u83B7\u53D6\n\n// !! \u539Fchrome \u63D2\u4EF6 \u5728background \u8FDB\u884C\u5B58\u50A8\uFF0C\u4F3C\u4E4E\u53EA\u8981\u5728 content-scripts \u4E2D\u8FDB\u884C\u5B58\u50A8\u5373\u53EF \uFF0C\u8FD9\u6837\u662F\u4E0D\u662F\u5C31\u4E0D\u9700\u8981\u5224\u65AD\u9009\u9879\u5361\u4E86\n\n// content-scripts \u53EA\u80FD\u8BBF\u95EE\u4EE5\u4E0BApi\n// chrome.runtime\n// chrome.extension (manifest_version <=2)\n// chrome.i18n\n// chrome.storage\n\n// TODO  \u7B80\u5316\u4EE3\u7801\uFF0C\u4F7F\u7528 \u6B63\u5219\u8FDB\u884C\u6807\u7B7E\u5339\u914D\n\nlet showIconsList = []\nlet showImagesList = []\nconst httpRegex = new RegExp(/http/)\n\nloadScript()\n\n// \u76D1\u542C\u6765\u81EA background \u7684\u6D88\u606F\nchrome.runtime.onMessage.addListener(function (request, sender, sendResponse) {\n  sendResponse('background\u4F60\u597D\uFF0C\u6211\u6536\u5230\u4E86\u4F60\u7684\u6D88\u606F\uFF01' + request.type)\n\n  if (request.type === 'tabUpdate') {\n    loadScript()\n  }\n})\n\n// \u5C06\u5185\u5BB9\u5B58\u50A8\u5728 storage \u533A\u57DF\n// TODO  \u5F02\u6B65\u5C06\u9875\u9762\u6570\u636E\u8C03\u53D6\u540E\u5B8C\u6210\u5B58\u50A8\uFF0C\u5F53\u91CD\u65B0\u70B9\u51FB popup\u65F6\uFF0C\u5BF9\u4E8E\u5DF2\u5B58\u50A8\u7684tabId\uFF0C\u76F4\u63A5\u4F7F\u7528\u539F\u6709\u7684\u6570\u636E\n// TODO  id \u9875\u9762\u53D1\u751F\u53D8\u5316\u65F6\u5237\u65B0\u8C03\u53D6\u5185\u5BB9\nfunction savePageData(dataInfo) {\n  let result = []\n  Object.keys(dataInfo).forEach(item => {\n    const imgKeys = ['icons', 'imgs']\n    result.push({\n      title: item,\n      type: imgKeys.includes(item) ? 'img' : 'text',\n      content: dataInfo[item]\n    })\n  })\n  chrome.storage.sync.get(['LocalPageData'], res => {\n    chrome.storage.sync.set({ LocalPageData: [result] }, () => {\n      // console.log('xy-react \u8BBE\u7F6E\u6570\u636E\u6210\u529F', result)\n    })\n  })\n}\n\nasync function loadScript(id) {\n  LocalPageDataInfo = []\n  showIconsList = []\n  showImagesList = []\n\n  loadInfo(true)\n\n  async function loadInfo(hasLoadFetch) {\n    // ================================ \u83B7\u53D6\u7F51\u9875\u7684 Icon =================================\n    async function getIcons() {\n      let requestList = []\n      // \u65B9\u5F0F\u4E00 \u76F4\u63A5\u83B7\u53D6link\u5C5E\u6027 \u622A\u53D6url\u3002 shortcut icon \u662F\u8FC7\u65F6\u7684\u5199\u6CD5\n      requestList.push(\n        new Promise((resolve, reject) => {\n          const textArr = ['shortcut icon', 'icon', 'alternate icon', 'mask-icon', 'apple-touch-icon']\n          textArr.forEach(item => {\n            let checkHref = document.querySelector(`link[rel=\"${item}\"]`)?.href\n            if (checkHref) showIconsList.push(checkHref)\n          })\n          resolve()\n        })\n      )\n\n      // \u65B9\u5F0F\u4E8C PWA \u5E94\u7528\u53EF\u4EE5\u83B7\u53D6\u6839\u57DF\u540D\u7684manifest  \u6709\u94FE\u63A5\u7684\u8FD4\u56DE\u94FE\u63A5 \u6CA1\u6709\u7684\u76F4\u63A5\u8FDB\u884C\u62FC\u63A5\n      // \u53EA\u6709 fetch \u5F15\u5165\u6210\u529F\u65F6\u624D\u53EF\u4EE5\u4F7F\u7528\n      if (hasLoadFetch) {\n        requestList.push(\n          new Promise((resolve, reject) => {\n            let pwaUrl = document.querySelector('link[rel=\"manifest\"]')?.href\n            if (pwaUrl) {\n              fetch(pwaUrl)\n                .then(async res => {\n                  let data = await res.json()\n\n                  if (!data.icons || !data.icons.length) return\n\n                  data.icons.forEach((iconItem, iconIndex) => {\n                    let url = httpRegex.test(iconItem.src) ? iconItem.src : document.location.origin + '/' + iconItem.src\n                    showIconsList.push(url)\n                  })\n\n                  resolve()\n                })\n                .catch(() => {\n                  resolve()\n                })\n            } else {\n              resolve()\n            }\n          })\n        )\n      }\n\n      // \u65B9\u5F0F\u4E09 \u672A\u8BBE\u7F6E link rel=type,\u800C\u662F\u76F4\u63A5\u653E\u5230\u7F51\u7AD9\u6839\u76EE\u5F55\u4E0B\uFF0C\u6D4F\u89C8\u5668\u4F1A  \u76F4\u63A5\u83B7\u53D6 favicon.ico\n      requestList.push(\n        new Promise((resolve, reject) => {\n          let img = new Image()\n          img.src = document.location.origin + '/favicon.ico'\n          img.crossOrigin = 'anonymous'\n          img.onload = function () {\n            // console.log('\u6DFB\u52A0icon')\n            showIconsList.push(img.src)\n            resolve()\n          }\n          img.onerror = function () {\n            console.log('\u8BE5\u94FE\u63A5\u65E0\u6548', img.src)\n            resolve()\n          }\n        })\n      )\n\n      return Promise.all(requestList)\n    }\n\n    // \u83B7\u53D6\u7F51\u9875\u63CF\u8FF0\n    function getDesc() {\n      const textArrDes = ['description', 'twitter:description']\n      const richList = ['og:description', 'twitter:description']\n      let oMe = document.getElementsByTagName('meta')\n\n      let descList = []\n      for (let i = 0; i < oMe.length; i++) {\n        if (textArrDes.includes(oMe[i].getAttribute('name'))) {\n          descList.push(oMe[i].getAttribute('content'))\n        }\n        if (richList.includes(oMe[i].getAttribute('property'))) {\n          descList.push(oMe[i].getAttribute('content'))\n        }\n      }\n      // console.log(\"\u63CF\u8FF0List\", descList);\n\n      return descList\n    }\n\n    // ========================== \u83B7\u53D6\u7F51\u9875\u9884\u89C8\u56FE =====================================\n    async function getImgs() {\n      const textArrDes = ['image', 'twitter:image', 'twitter:image:src']\n      const richList = ['og:image']\n      const catchProperty = ['name', 'property', 'itemprop']\n      let oMe = document.getElementsByTagName('meta')\n\n      let subImgs = []\n      // \u6446\u70C2 - \u6CA1\u6709\u7684\u4E0D\u4F1A\u5339\u914D\u5230 - \u5C31\u8FD9\u6837\u5427\n      for (let i = 0; i < oMe.length; i++) {\n        catchProperty.forEach(y => {\n          let imgContent = oMe[i].getAttribute('content')\n\n          let url = httpRegex.test(imgContent) ? imgContent : document.location.origin + '/' + imgContent\n\n          if (textArrDes.includes(oMe[i].getAttribute(y))) {\n            subImgs.push(url)\n          }\n          if (richList.includes(oMe[i].getAttribute(y))) {\n            subImgs.push(url)\n          }\n        })\n      }\n      // console.log(\"\u9884\u89C8\u56FEList\", subImgs);\n      showImagesList = subImgs\n    }\n\n    // \u83B7\u53D6\u7F51\u9875title\n    const titles = document.getElementsByTagName('title')\n    const pageTitle = titles[0]?.innerText\n\n    // \u83B7\u53D6\u7F51\u9875\u94FE\u63A5\n    const linkUrl = window.location.href\n\n    // description\n    const desc = getDesc()[0] || ''\n\n    // \u83B7\u53D6\u7F51\u9875\u5173\u952E\u8BCD\n    const keywords = document.querySelector('meta[name=\"keywords\"]')?.content || ''\n\n    // \u83B7\u53D6\u7F51\u9875icon\n    await getIcons()\n\n    // \u83B7\u53D6\u7F51\u9875\u9884\u89C8\u56FE\n    getImgs()\n\n    addContent()\n\n    // \u5C06\u83B7\u53D6\u5230\u7684\u6570\u636E \u4F20\u8F93\u7ED9background.js \u6216\u8005 popup.js\n    function addContent() {\n      let pageData = {\n        tabId: id || 0,\n        pageTitle,\n        linkUrl,\n        desc,\n        keywords,\n        icons: showIconsList,\n        imgs: showImagesList\n      }\n      LocalPageDataInfo = pageData\n      // console.log('xy-react \u83B7\u53D6\u9875\u9762\u6570\u636E\u5185\u5BB9', pageData, LocalPageDataInfo)\n      savePageData(pageData)\n    }\n  }\n}\n"],
  "mappings": "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",
  "names": []
}
